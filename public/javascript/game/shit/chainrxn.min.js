function shareTitle(t,e){var i,r;return i=9>e?Math.round(9.126*e*100)/100:100>82.134+.219*(e-9)?Math.round(100*(82.134+.219*(e-9)))/100:1234.56,9>e&&(r="我炸了"+t+"分,停留在第"+e+"关,击败了全国"+i+"%的人,屎学界对我尚未定论"),e>=9&&t>45000001&&(r="我炸了"+t+"分就过关了,击败了全国"+i+"%的人,成为了屎皇帝！"),e>=9&&45000001>t&&(r="我炸了"+t+"分过关,击败了全国"+i+"%的人,屎里有毒！"),r}var chainrxn=!1;Ball=new Class({number:0,xposition:0,yposition:0,downspeed:0,rightspeed:0,color:"#fff",srcs:"images/shit.png",radius:0,expanding:0,sizeChangeCount:0,disabled:!1,expanded:!1,chainlevel:0,initialize:function(t,e,i,r){if(this.number=e,this.gameLevel=t,this.radius=this.gameLevel.ballSize,null==i){this.xposition=(this.gameLevel.xmax-2*this.gameLevel.ballSize)*Math.random()+this.gameLevel.ballSize,this.yposition=(this.gameLevel.ymax-2*this.gameLevel.ballSize)*Math.random()+this.gameLevel.ballSize;var n=360*Math.random();this.downspeed=Math.cos(n)*this.gameLevel.ballSpeed,this.rightspeed=Math.sin(n)*this.gameLevel.ballSpeed,this.color="rgb("+Math.round(255*Math.random())+", "+Math.round(255*Math.random())+", "+Math.round(255*Math.random())+")"}else this.xposition=i,this.yposition=r,this.color="rgb(150,150,150)",this.startExpansion();this.gameLevel.movingBalls.push(this),this.draw()},move:function(){this.xposition+=this.rightspeed,this.yposition+=this.downspeed,this.draw();var t=!0;this.gameLevel.expandedBalls.each(function(e){t&&1==this.gameLevel.movingBalls[e].expanded&&Math.sqrt(Math.pow(this.gameLevel.movingBalls[e].xposition-this.xposition,2)+Math.pow(this.gameLevel.movingBalls[e].yposition-this.yposition,2))<=this.radius+this.gameLevel.movingBalls[e].radius&&(this.chainlevel=this.gameLevel.movingBalls[e].chainlevel+1,this.startExpansion(),t=!1)}.bind(this)),t&&((this.xposition<=this.gameLevel.ballSize||this.xposition>=this.gameLevel.xmax-this.gameLevel.ballSize)&&(this.rightspeed=-1*this.rightspeed),(this.yposition<=this.gameLevel.ballSize||this.yposition>=this.gameLevel.ymax-this.gameLevel.ballSize)&&(this.downspeed=-1*this.downspeed))},startExpansion:function(){this.expanded=!0,this.gameLevel.expandedBalls.push(this.number),this.gameLevel.totalBallsExpanded++,this.gameLevel.chainrxn.ballsExpandedEl.set("text","已经炸了"+this.gameLevel.totalBallsExpanded+"份了");var t=100*Math.pow(this.chainlevel,3);if(this.gameLevel.score+=t,this.gameLevel.chainrxn.levelScoreEl.set("text",this.gameLevel.score+"关卡分"),this.gameLevel.chainrxn.totalScoreEl.set("text",this.gameLevel.score+this.gameLevel.chainrxn.score+" 总分"),this.downspeed=0,this.rightspeed=0,this.expanding=1,this.gameLevel.totalBallsExpanded>=this.gameLevel.ballWinCount&&"#333"!=document.body.getStyle("background")&&this.gameLevel.showWinBG(),function(){this.expanding=-1,this.sizeChangeCount=this.gameLevel.shrinkingIntervals}.bind(this).delay(this.gameLevel.expandedLifeLength),this.number!=this.gameLevel.numBalls){var e=this.gameLevel.chainrxn.ballField.getCoordinates(),i=new Element("div",{text:"+"+t}).inject(document.body);i.addClass("points"),i.setStyles({position:"absolute",top:this.yposition+e.top-this.gameLevel.pointPopupHeight/2,left:this.xposition+e.left-this.gameLevel.pointPopupWidth/2}),function(){i.destroy()}.delay(this.gameLevel.expandedLifeLength,this)}},expand:function(){this.radius=Math.round(this.sizeChangeCount*(this.gameLevel.expandedBallSize-this.gameLevel.ballSize)/this.gameLevel.expandingIntervals+this.gameLevel.ballSize)+15,this.draw(),this.sizeChangeCount++,this.gameLevel.expandingIntervals<this.sizeChangeCount&&(this.sizeChangeCount=0,this.expanding=2)},shrink:function(){this.radius=Math.round(this.sizeChangeCount*this.gameLevel.expandedBallSize/this.gameLevel.shrinkingIntervals),this.draw(),0==this.sizeChangeCount&&(this.expanded=!1,this.expanding=0,this.gameLevel.expandedBalls.erase(this.number),this.disabled=!0),this.sizeChangeCount--},maintain:function(){1==this.expanding?this.expand():-1==this.expanding?this.shrink():1==this.expanded?this.draw():0==this.disabled&&this.move()},draw:function(){if(this.gameLevel.canvas.beginPath(),this.gameLevel.canvas.fillStyle=this.color,this.gameLevel.canvas.moveTo(this.xposition,this.yposition),this.expanding)this.gameLevel.canvas.arc(this.xposition,this.yposition,this.radius,0,2*Math.PI,!0);else{var t=new Image;t.src=this.srcs,this.gameLevel.canvas.drawImage(t,this.xposition,this.yposition)}this.gameLevel.canvas.closePath(),this.gameLevel.canvas.fill()}});var StarterBall=new Class({element:!1,xposition:!1,yposition:!1,gameLevel:!1,initialize:function(t){this.gameLevel=t;var e=this.gameLevel.chainrxn.ballField.getCoordinates(),i=this.gameLevel.chainrxn.ballField.getSize();this.element=new Element("div",{id:"starterBall"}).inject(document.body),this.xposition=e.left+i.x/2,this.yposition=e.top+i.y/2,this.move()},checkBounds:function(){var t=this.gameLevel.chainrxn.ballField.getCoordinates(),e=this.gameLevel.ymax+t.top,i=this.gameLevel.xmax+t.left;this.xposition>i?this.xposition=i:this.xposition<t.left&&(this.xposition=t.left),this.yposition>e?this.yposition=e:this.yposition<t.top&&(this.yposition=t.top)},move:function(){this.checkBounds(),this.element.setStyles({top:this.yposition-this.gameLevel.starterBallSize,left:this.xposition-this.gameLevel.starterBallSize})},place:function(t){t.pageX?(this.xposition=t.pageX,this.yposition=t.pageY):(this.xposition=t.page.x,this.yposition=t.page.y),this.checkBounds();var e=this.gameLevel.chainrxn.ballField.getCoordinates();new Ball(this.gameLevel,this.gameLevel.numBalls,this.xposition-e.left,this.yposition-e.top),this.element.removeClass("starterBall"),this.element.destroy(),$$("body")[0].removeEvents("mousemove"),$$("body")[0].removeEvents("click")}}),GameLevel=new Class({ballSize:5,expandedBallSize:5,ballSpeed:4,numBalls:5,ballWinCount:4,checkInterval:30,expandDelay:300,shrinkDelay:1500,expandedLifeLength:3300,starterBallSize:92,ballOpacity:0,xmax:640,ymax:960,chainrxn:!1,ballField:!1,expandedBalls:[],movingBalls:[],repeater:!1,totalBallsExpanded:-1,score:0,expandingIntervals:0,pointPopupHeight:20,pointPopupWidth:50,canvas:!1,initialize:function(t,e){if(this.chainrxn=e,this.chainrxn.ballField.setStyle("background-color","#333"),this.xmax=parseInt(this.chainrxn.ballField.getStyle("width")),this.ymax=parseInt(this.chainrxn.ballField.getStyle("height")),this.xmax*this.ymax<5e5&&(this.expandedBallSize=24,this.ballSize=4,this.ballSpeed=2),this.xmax*this.ymax>=8e5&&this.xmax*this.ymax<12e5&&(this.expandedBallSize=45,this.ballSize=6,this.ballSpeed=5),this.xmax*this.ymax>=12e5&&(this.expandedBallSize=55,this.ballSize=7,this.ballSpeed=5),!this.chainrxn.ballField.getContext)return alert("Your browser does not appear to support canvas, and our attempts to emulate it have failed.");this.canvas=this.chainrxn.ballField.getContext("2d"),this.chainrxn.ballField.set({height:this.ymax,width:this.xmax}),this.canvas.globalAlpha=.7,this.numBalls=t[1],this.ballWinCount=t[0],this.expandingIntervals=Math.round(this.expandDelay/this.checkInterval),this.shrinkingIntervals=Math.round(this.shrinkDelay/this.checkInterval);for(var i=0;i<this.numBalls;i++)new Ball(this,i);starterBall=new StarterBall(this),this.repeater=function(){this.canvas.clearRect(0,0,this.xmax+this.ballSize,this.ymax+this.ballSize),$chk(starterBall)?starterBall.move():0==this.expandedBalls.length&&(this.totalBallsExpanded<this.ballWinCount?this.doLoser():this.doWinner()),this.movingBalls.each(function(t){t.maintain()}.bind(this))}.bind(this).periodical(this.checkInterval),$$("body")[0].addEvent("mousemove",function(t){starterBall.xposition=t.page.x,starterBall.yposition=t.page.y}.bind(this)),$$("body")[0].addEvent("touchmove",function(t){var e=t.changedTouches[0];starterBall.xposition=e.pageX,starterBall.yposition=e.pageY}.bind(this)),$$("body")[0].addEvent("touchend",function(){}.bind(this)),$$("body")[0].addEvent("click",function(t){"notifierButton"!=t.target.id&&(t.changedTouches&&(t=t.changedTouches[0]),starterBall.place(t),starterBall=null,this.chainrxn.levelNumberEl.set("text","第"+(this.chainrxn.levelNumber+1)+"关"))}.bind(this))},showWinBG:function(){this.chainrxn.ballField.set("morph",{duration:1e3}),this.chainrxn.ballField.morph({"background-color":"#525252"})},doLoser:function(){this.repeater=$clear(this.repeater),this.canvas.clearRect(0,0,this.xmax+this.ballSize,this.ymax+this.ballSize),this.chainrxn.repeatLevel(this.score)},doWinner:function(){this.repeater=$clear(this.repeater),function(){this.canvas.clearRect(0,0,this.xmax+this.ballSize,this.ymax+this.ballSize),this.chainrxn.doNextLevel(this.score)}.delay(this.expandDelay,this)}}),ChainRxn=new Class({score:0,game:!1,notifierBox:!1,notifierTitle:!1,notifierButton:!1,notifierButton2:!1,ballsExpandedEl:!1,levelScoreEl:!1,totalScoreEl:!1,levelNumberEl:!1,ballField:!1,levels:[[1,10],[4,20],[8,30],[15,40],[25,50],[40,60],[57,70],[70,80],[80,90],[90,100],[100,110]],levelNumber:0,initialize:function(){this.notifierBox=$m("notifierBox"),this.notifierTitle=$m("notifierTitle"),this.notifierButton=$m("notifierButton"),this.notifierButton2=$m("notifierButton2"),this.ballsExpandedEl=$m("ballsExpanded"),this.levelScoreEl=$m("levelScore"),this.totalScoreEl=$m("totalScore"),this.levelNumberEl=$m("levelNumber"),this.ballField=$m("ballField"),this.notifierButton.addEvent("click",function(){this.notifierButton.removeEvents(),this.newGame()}.bind(this))},repeatLevel:function(t){dp_submitScore(this.score+t,this.levelNumber),this.notifierTitle.set("text","游戏结束！累计得分"+(this.score+t)),this.notifierButton.set("text","重新开始"),document.getElementById("html5").src="images/html4.png",this.notifierBox.setStyle("display",""),this.notifierButton.addEvent("click",function(){this.levelNumber=0,this.score=0,this.newGame()}.bind(this)),this.notifierButton2.addEvent("click",function(){clickMore()})},doNextLevel:function(t){this.levelNumber++,this.score+=t,this.notifierTitle.set("text","成功击退屎群！累计得分"+this.score),this.notifierBox.setStyle("display",""),document.getElementById("html5").src="images/html3.png",this.levelNumber<this.levels.length?(this.notifierButton.set("text","开炸"),this.notifierButton.addEvent("click",function(){this.newGame()}.bind(this)),this.notifierButton2.addEvent("click",function(){clickMore()})):(dp_submitScore(this.score,this.levelNumber),this.notifierTitle.set("text","恭喜您全部过关了!"),this.notifierButton.set("text","重新再炸"),this.notifierButton.addEvent("click",function(){window.location=window.location}),this.notifierButton2.addEvent("click",function(){clickMore()}))},newGame:function(){this.ballsExpandedEl.empty(),this.levelScoreEl.empty(),this.totalScoreEl.empty(),this.levelNumberEl.empty(),this.notifierTitle.set("text","炸掉"+this.levels[this.levelNumber][0]+"坨屎"),this.notifierButton.set("text","开炸"),this.notifierButton.removeEvents(),this.notifierButton.addEvent("click",function(){this.notifierBox.setStyle("display","none"),this.notifierButton.removeEvents(),this.game=new GameLevel(this.levels[this.levelNumber],this)}.bind(this)),this.notifierButton2.addEvent("click",function(){clickMore()})}});window.addEvent("load",function(){chainrxn=new ChainRxn}.bind(this));