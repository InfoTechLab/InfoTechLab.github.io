function removeParameter(t,e){if(-1==t.indexOf("?"))return t;var i=t.split("?")[0],r=t.split("?")[1],n=!1;"#rd"==r.substr(r.length-3)&&(r=r.substr(0,r.length-3),n=!0);for(var s=r.split("&"),a=s.length-1;a>=0;a--){var o=s[a].substr(0,s[a].indexOf("="));o==e&&s.splice(a,1)}var u;return u=0==s.length?i:i+"?"+s.join("&"),n&&(u+="#rd"),u}Auth9G=function(t){this.gameid=t,this.title=document.title,this.uid=null,this.myuid=null,this.accessToken=null,this.user=null,this.order="desc",this.identify=function(){},this.ready=function(){},this.readyDone=!1,this.baseUrl="http://wx.9g.com",this.gameUrl="http://game.9g.com",this.init()},Auth9G.prototype.init=function(){this.uid=this.getParameter("uid"),console.log("uid="+this.uid)},Auth9G.prototype.isWeixin=function(){var t=navigator.userAgent.toLowerCase();return"micromessenger"==t.match(/MicroMessenger/i)?!0:!1},Auth9G.prototype.connect=function(t,e){var i;setTimeout(function(){void 0==i&&(i=!1,e&&e.call(null),console.log("连接超过2秒"))},2e3),jQuery.ajax({type:"GET",async:!0,cache:!1,timeout:5e3,url:this.baseUrl+"/auth/connect",dataType:"jsonp",jsonp:"callback",jsonpCallback:"authConnectHandler",success:function(e){console.log(e),"ok"==e.success&&void 0==i&&(i=!0,t&&t.call(null),console.log("连接测试成功!"))}})},Auth9G.prototype.check=function(){if(document.title="9G游戏",document.body.style.display="none",!this.isWeixin())return console.log("非微信浏览器"),void this.doReady();if(console.log(window.localStorage),!window.localStorage)return console.log("不支持 localStorage"),void this.doReady();if(localStorage.accessToken&&(this.accessToken=localStorage.accessToken,this.doReady()),void 0!=sessionStorage.errcode)return console.log("errcode="+sessionStorage.errcode+", errmsg="+sessionStorage.errmsg),sessionStorage.removeItem("errcode"),sessionStorage.removeItem("errmsg"),void this.doReady();var t=this;this.connect(function(){t.accessToken?t.get9gUser(t.accessToken):t.check9gAuth()},function(){document.title=t.title,document.body.style.display="",setTimeout(function(){try{WeixinJSBridge.call("showOptionMenu")}catch(t){}},2e3)})},Auth9G.prototype.doReady=function(){this.readyDone||(document.title=this.title,document.body.style.display="",this.ready&&this.ready.call(null),this.readyDone=!0,console.log("ready"),setTimeout(function(){try{WeixinJSBridge.call("showOptionMenu")}catch(t){}},2e3))},Auth9G.prototype.check9gAuth=function(){var t=removeParameter(window.location.href,"uid"),e=this.gameUrl+"/auth/trans.html?gameid="+this.gameid+"&origin="+encodeURIComponent(t),i=this.baseUrl+"/auth/check?fromurl="+encodeURIComponent(e);null!=this.uid&&(i+="&uid="+this.uid),window.location=i},Auth9G.prototype.get9gUser=function(t){var e=this;jQuery.ajax({type:"GET",async:!0,cache:!1,url:this.baseUrl+"/auth/get9guser?access_token="+t,dataType:"jsonp",jsonp:"callback",jsonpCallback:"get9gUserHandler",success:function(t){t.errcode?(localStorage.removeItem("accessToken"),e.accessToken=null,e.check9gAuth()):(e.myuid=t.uid,e.user=t.user,e.identify&&e.identify.call(null),console.log(t))},error:function(t,e,i){alert(e+"\n"+i)}})},Auth9G.prototype.gotoRank=function(t){var e=this.baseUrl+"/rank/rank.jsp?gameid="+this.gameid+"&order="+this.order+"&type="+t;window.location=e},Auth9G.prototype.submit=function(t,e,i){this.user&&jQuery.ajax({type:"GET",async:!0,cache:!1,url:this.baseUrl+"/rank/submit.jsp?gameid="+this.gameid+"&access_token="+this.accessToken+"&score="+t+"&scorename="+encodeURIComponent(e)+"&order="+this.order,dataType:"jsonp",jsonp:"callback",jsonpCallback:"submitCompleteHandler",success:function(t){alert("ok"==t.submit?t.refreshRankScore?"你的成绩已经成功提交到9G！\n刷新了上一次的最好成绩: "+t.lastRankScoreName:"你的成绩已经成功提交到9G！":"提交成绩失败"),i&&i.apply(null)},error:function(t,e,i){alert(e+"\n"+i)}})},Auth9G.prototype.getParameter=function(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),i=window.location.search.substr(1).match(e);return null!=i?i[2]:null};