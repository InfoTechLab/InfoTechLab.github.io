function SwitchFld(t,e){return 0>t?!1:t>=Size?!1:0>e?!1:e>=Size?!1:(Fld[t][e]=1-Fld[t][e],!0)}function Init(t){var e,r,n;if(t){for(Fld=new Array(Size),i=0;Size>i;i++)Fld[i]=new Array(Size);for(PreFld=new Array(Size),i=0;Size>i;i++)PreFld[i]=new Array(Size);for(e=0;Size>e;e++)for(r=0;Size>r;r++)Fld[e][r]=0;for(n=0;19>n;n++)e=Math.floor(Math.random()*Size),r=Math.floor(Math.random()*Size),SwitchFld(e-1,r),SwitchFld(e+1,r),SwitchFld(e,r-1),SwitchFld(e,r+1),SwitchFld(e,r);for(e=0;Size>e;e++)for(r=0;Size>r;r++)PreFld[e][r]=Fld[e][r];IsRepeat=!1}else{for(e=0;Size>e;e++)for(r=0;Size>r;r++)Fld[e][r]=PreFld[e][r];IsRepeat=!0}IsOver=!1,NMoves=0,RefreshScreen(1),Now=new Date,StartTime=Now.getTime()/1e3,$("#movecount").text(NMoves),$("#result_container").hide()}function Clicked(t,e){SwitchFld(t-1,e)&&RefreshPic(t-1,e),SwitchFld(t+1,e)&&RefreshPic(t+1,e),SwitchFld(t,e-1)&&RefreshPic(t,e-1),SwitchFld(t,e+1)&&RefreshPic(t,e+1),SwitchFld(t,e)&&RefreshPic(t,e),IsOver||(NMoves++,$("#movecount").text(NMoves),OverTest())}function OverTest(){var t,e,i=0;for(t=0;Size>t;t++)for(e=0;Size>e;e++)i+=Fld[t][e];if(i===Size*Size){IsOver=!0,Now=new Date,EndTime=Now.getTime()/1e3,i=Math.floor(EndTime-StartTime);var r="真是萌萌哒！";10>i?r="是神童啊！":20>i?r="是天才啊！":30>i&&(r="真聪明!");var s="用 "+NMoves+" 步点亮了所有的盏灯。";$("#result").html("哇！你"+s+"你"+r),$("#result_container").show(),dp_submitScore(NMoves,i)}}function RefreshPic(t,e){$("#table img")[Size*e+t].src=Pic[Fld[t][e]].src}function RefreshScreen(){var t,e;for(t=0;Size>t;t++)for(e=0;Size>e;e++)$("#table img")[Size*e+t].src=Pic[Fld[t][e]].src}function switchSize(){Size=4===Size?5:4,draw(),Init(!0),$("#switchBtn").val(4===Size?"换个有难度的":"来个简单点的")}function draw(){var t=[];for(j=0;Size>j;j++){for(t.push("<tr>"),i=0;Size>i;i++)t.push("<td><IMG src='images/light103.png' border=0 onclick=\"Clicked("+i+","+j+')"></td>');t.push("</tr>")}$("#table").html(t.join(""))}var i,j,IsOver,Size=4,StartTime,EndTime,Moves,IsRepeat;for(Pic=new Array(2),Pic[0]=new Image,Pic[0].src="images/light0.png",Pic[1]=new Image,Pic[1].src="images/light103.png",Fld=new Array(Size),i=0;Size>i;i++)Fld[i]=new Array(Size);for(PreFld=new Array(Size),i=0;Size>i;i++)PreFld[i]=new Array(Size);