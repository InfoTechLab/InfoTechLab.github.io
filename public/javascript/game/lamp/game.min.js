function SwitchFld(e,t){return 0>e?!1:e>=Size?!1:0>t?!1:t>=Size?!1:(Fld[e][t]=1-Fld[e][t],!0)}function Init(e){var t,n,s;if(e){for(Fld=new Array(Size),i=0;Size>i;i++)Fld[i]=new Array(Size);for(PreFld=new Array(Size),i=0;Size>i;i++)PreFld[i]=new Array(Size);for(t=0;Size>t;t++)for(n=0;Size>n;n++)Fld[t][n]=0;for(s=0;19>s;s++)t=Math.floor(Math.random()*Size),n=Math.floor(Math.random()*Size),SwitchFld(t-1,n),SwitchFld(t+1,n),SwitchFld(t,n-1),SwitchFld(t,n+1),SwitchFld(t,n);for(t=0;Size>t;t++)for(n=0;Size>n;n++)PreFld[t][n]=Fld[t][n];IsRepeat=!1}else{for(t=0;Size>t;t++)for(n=0;Size>n;n++)Fld[t][n]=PreFld[t][n];IsRepeat=!0}IsOver=!1,NMoves=0,RefreshScreen(1),Now=new Date,StartTime=Now.getTime()/1e3,$("#movecount").text(NMoves),$("#result_container").hide()}function Clicked(e,t){SwitchFld(e-1,t)&&RefreshPic(e-1,t),SwitchFld(e+1,t)&&RefreshPic(e+1,t),SwitchFld(e,t-1)&&RefreshPic(e,t-1),SwitchFld(e,t+1)&&RefreshPic(e,t+1),SwitchFld(e,t)&&RefreshPic(e,t),IsOver||(NMoves++,$("#movecount").text(NMoves),OverTest())}function OverTest(){var e,t,i=0;for(e=0;Size>e;e++)for(t=0;Size>t;t++)i+=Fld[e][t];if(i===Size*Size){IsOver=!0,Now=new Date,EndTime=Now.getTime()/1e3,i=Math.floor(EndTime-StartTime);var n="真是萌萌哒！";10>i?n="是神童啊！":20>i?n="是天才啊！":30>i&&(n="真聪明!");var a="用 "+NMoves+" 步点亮了所有的盏灯。";$("#result").html("哇！你"+a+"你"+n),$("#result_container").show(),dp_submitScore(NMoves,i)}}function RefreshPic(e,t){$("#table img")[Size*t+e].src=Pic[Fld[e][t]].src}function RefreshScreen(){var e,t;for(e=0;Size>e;e++)for(t=0;Size>t;t++)$("#table img")[Size*t+e].src=Pic[Fld[e][t]].src}function switchSize(){Size=4===Size?5:4,draw(),Init(!0),$("#switchBtn").val(4===Size?"换个有难度的":"来个简单点的")}function draw(){var e=[];for(j=0;Size>j;j++){for(e.push("<tr>"),i=0;Size>i;i++)e.push("<td><IMG src='images/light103.png' border=0 onclick=\"Clicked("+i+","+j+')"></td>');e.push("</tr>")}$("#table").html(e.join(""))}var i,j,IsOver,Size=4,StartTime,EndTime,Moves,IsRepeat;for(Pic=new Array(2),Pic[0]=new Image,Pic[0].src="images/light0.png",Pic[1]=new Image,Pic[1].src="images/light103.png",Fld=new Array(Size),i=0;Size>i;i++)Fld[i]=new Array(Size);for(PreFld=new Array(Size),i=0;Size>i;i++)PreFld[i]=new Array(Size);